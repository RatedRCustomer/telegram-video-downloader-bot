# ğŸ¥ Telegram Video Downloader Bot v4.0

Production-ready Telegram bot Ğ´Ğ»Ñ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ²Ñ–Ğ´ĞµĞ¾ Ğ· YouTube, TikTok, Instagram, Threads, Twitch Ñ‚Ğ° Ñ–Ğ½ÑˆĞ¸Ñ… Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼.

## âœ¨ Features

### Core Features
- ğŸ¯ **Auto-quality** - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ²Ğ¸Ğ±Ğ¸Ñ€Ğ°Ñ” Ğ½Ğ°Ğ¹ĞºÑ€Ğ°Ñ‰Ñƒ ÑĞºÑ–ÑÑ‚ÑŒ Ğ´Ğ¾ 50MB
- ğŸ–¼ **Thumbnail preview** - Ğ¿Ğ¾ĞºĞ°Ğ·ÑƒÑ” Ğ¿Ñ€ĞµĞ²'Ñ Ğ²Ñ–Ğ´ĞµĞ¾ Ğ¿ĞµÑ€ĞµĞ´ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½ÑĞ¼
- ğŸ”— **Inline mode** - `@bot_username URL` Ğ¿Ñ€Ğ°Ñ†ÑÑ” Ğ² Ğ±ÑƒĞ´ÑŒ-ÑĞºĞ¾Ğ¼Ñƒ Ñ‡Ğ°Ñ‚Ñ–
- ğŸµ Audio extraction (MP3)
- ğŸ“Š Quality selection (360p-1080p)
- âš¡ Smart cache (Ğ¼Ğ¸Ñ‚Ñ‚Ñ”Ğ²Ñ– Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ñ– Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ)
- ğŸ‘¥ Group support (auto-download Ğ±ĞµĞ· Ñ‚ĞµĞ³Ñ–Ğ²)
- ğŸª Instagram cookies support (Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ– Ğ²Ñ–Ğ´ĞµĞ¾)

### v4.0 Architecture (NEW!)
- ğŸš€ **aiogram** - ÑÑƒÑ‡Ğ°ÑĞ½Ğ¸Ğ¹ async Ğ±Ğ¾Ñ‚ Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº
- ğŸ”„ **Celery + Redis** - Ñ€Ğ¾Ğ·Ğ¿Ğ¾Ğ´Ñ–Ğ»ĞµĞ½Ğ° Ñ‡ĞµÑ€Ğ³Ğ° Ğ·Ğ°Ğ´Ğ°Ñ‡
- ğŸŒ **Webhook mode** - Ğ·Ğ°Ğ¼Ñ–ÑÑ‚ÑŒ polling Ğ´Ğ»Ñ ÑˆĞ²Ğ¸Ğ´ÑˆĞ¾Ğ³Ğ¾ Ğ²Ñ–Ğ´Ğ³ÑƒĞºÑƒ
- ğŸ˜ **PostgreSQL** - Ğ½Ğ°Ğ´Ñ–Ğ¹Ğ½Ğµ Ğ·Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ğ½Ğ½Ñ Ğ´Ğ°Ğ½Ğ¸Ñ…
- ğŸ“¦ **MinIO** - S3-ÑÑƒĞ¼Ñ–ÑĞ½Ğµ ÑÑ…Ğ¾Ğ²Ğ¸Ñ‰Ğµ Ğ´Ğ»Ñ Ñ„Ğ°Ğ¹Ğ»Ñ–Ğ²
- ğŸŒ¸ **Flower** - Ğ¼Ğ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ²Ğ¾Ñ€ĞºĞµÑ€Ñ–Ğ²
- ğŸ“Š **Real-time progress** - Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ Ñ‡Ğ°ÑÑ–

## ğŸŒ Supported Platforms (9)

- YouTube / YouTube Shorts
- TikTok
- Instagram Reels / Stories
- Twitter/X
- Facebook
- Reddit
- Pinterest
- **Threads** (Meta)
- **Twitch Clips**

## ğŸš€ Quick Start

### v4.0 (Recommended for production)

```bash
# 1. Clone repository
git clone https://github.com/YOUR_USERNAME/telegram-video-bot.git
cd telegram-video-bot

# 2. Configure
cp .env.example .env
nano .env  # Add your TELEGRAM_BOT_TOKEN and other settings

# 3. Deploy v4.0
docker compose -f docker-compose.v4.yml up -d

# 4. Run migrations
docker compose -f docker-compose.v4.yml exec bot alembic upgrade head

# 5. Check logs
docker compose -f docker-compose.v4.yml logs -f
```

### v3.x (Legacy)

```bash
docker compose up -d
```

## ğŸ— v4.0 Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Telegram                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ Webhook
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    aiogram Bot (8443)                        â”‚
â”‚                  - Webhook handler                           â”‚
â”‚                  - Rate limiting                             â”‚
â”‚                  - User tracking                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Redis (6379)       â”‚     â”‚     PostgreSQL (5432)       â”‚
â”‚   - Task queue          â”‚     â”‚   - Video cache             â”‚
â”‚   - Progress pub/sub    â”‚     â”‚   - User stats              â”‚
â”‚   - Rate limiting       â”‚     â”‚   - Download history        â”‚
â”‚   - Caching             â”‚     â”‚   - Group stats             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Celery Workers                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Download Worker    â”‚    â”‚   Upload Worker     â”‚        â”‚
â”‚  â”‚  (queue: downloads) â”‚    â”‚  (queue: uploads)   â”‚        â”‚
â”‚  â”‚  concurrency: 2     â”‚    â”‚  concurrency: 3     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    yt-dlp Service                            â”‚
â”‚                  - Video download API                        â”‚
â”‚                  - Info extraction                           â”‚
â”‚                  - Format selection                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MinIO Storage (9000)                       â”‚
â”‚                  - S3-compatible storage                     â”‚
â”‚                  - /mnt/archive mount                        â”‚
â”‚                  - Downloaded videos                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Configuration

### Environment Variables (v4.0)

```env
# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token_here
WEBHOOK_URL=https://your-domain.com
WEBHOOK_PATH=/webhook
WEBHOOK_PORT=8443
ADMIN_IDS=123456789,987654321

# Database
DATABASE_URL=postgresql+asyncpg://videobot:password@postgres:5432/videobot

# Redis
REDIS_URL=redis://redis:6379/0
CELERY_BROKER_URL=redis://redis:6379/1
CELERY_RESULT_BACKEND=redis://redis:6379/2

# MinIO Storage
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=your_secure_password
MINIO_BUCKET=videos
MINIO_SECURE=false

# yt-dlp Service
YTDLP_SERVICE_URL=http://yt-dlp-api:8081

# Limits
MAX_FILE_SIZE=50000000
RATE_LIMIT_PER_MINUTE=10
```

### Docker Compose Services (v4.0)

| Service | Port | Description |
|---------|------|-------------|
| `bot` | 8443 | aiogram bot with webhook |
| `worker-download` | - | Celery download workers |
| `worker-upload` | - | Celery upload workers |
| `redis` | 6379 | Task queue & caching |
| `postgres` | 5432 | Persistent database |
| `minio` | 9000/9001 | S3-compatible storage |
| `flower` | 5555 | Celery monitoring |
| `yt-dlp-api` | 8081 | Video download API |

## ğŸ”— Inline Mode

Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ¹Ñ‚Ğµ Ğ±Ğ¾Ñ‚Ğ° Ğ² Ğ±ÑƒĞ´ÑŒ-ÑĞºĞ¾Ğ¼Ñƒ Ñ‡Ğ°Ñ‚Ñ–:

```
@your_bot_username https://www.youtube.com/watch?v=...
```

ĞĞ±ĞµÑ€Ñ–Ñ‚ÑŒ ÑĞºÑ–ÑÑ‚ÑŒ Ğ· Ğ¼ĞµĞ½Ñ:
- ğŸ¯ Auto (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ğ½Ğ¾) - Ğ½Ğ°Ğ¹ĞºÑ€Ğ°Ñ‰Ğ° ÑĞºÑ–ÑÑ‚ÑŒ Ğ´Ğ¾ 50MB
- ğŸ¥ 720p HD
- ğŸ’ 1080p Full HD
- ğŸµ Audio only (MP3)

## ğŸª Instagram Cookies (Optional)

Ğ”Ğ»Ñ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¸Ñ… Instagram Ğ²Ñ–Ğ´ĞµĞ¾:

1. Ğ•ĞºÑĞ¿Ğ¾Ñ€Ñ‚ÑƒĞ¹Ñ‚Ğµ cookies Ğ· Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ° (Ñ€Ğ¾Ğ·ÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ "Get cookies.txt")
2. Ğ—Ğ±ĞµÑ€ĞµĞ¶Ñ–Ñ‚ÑŒ ÑĞº `downloads/cookies.txt`
3. ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ñ–Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¸

```bash
docker compose -f docker-compose.v4.yml restart
```

## ğŸ“Š Monitoring

### Flower Dashboard
Web UI Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ñƒ Celery Ğ²Ğ¾Ñ€ĞºĞµÑ€Ñ–Ğ²: `http://localhost:5555`

### MinIO Console
Web UI Ğ´Ğ»Ñ ĞºĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼Ğ¸: `http://localhost:9001`

### Health Endpoints
- Bot health: `http://localhost:8443/health`
- Bot metrics: `http://localhost:8443/metrics`

## ğŸ“Š Performance

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | v3.x | v4.0 |
|---------|------|------|
| Response time | 5-10s | 2-5s |
| Cache hit | ~1s | ~0.5s |
| Max concurrent | 2 | 5+ |
| Scalability | Single server | Horizontal |
| Progress tracking | No | Real-time |

## ğŸ¯ Commands

| Command | Description |
|---------|-------------|
| `/start` | Bot welcome message |
| `/help` | Detailed help |
| `/stats` | Your download statistics |
| `/settings` | Bot settings |
| `/admin` | Admin panel (admins only) |

## ğŸ‘¥ Group Usage

1. Add bot to group
2. Give admin rights (to delete service messages)
3. Send video URL - bot auto-downloads!

## ğŸ“‹ Requirements

### v4.0 Production
- Docker & Docker Compose
- 8GB+ RAM (recommended)
- 4 CPU cores
- 50GB+ storage
- External storage mount for MinIO (`/mnt/archive`)

### v3.x Legacy
- Docker & Docker Compose
- 4GB+ RAM
- 10GB+ storage

## ğŸ”„ Changelog

### v4.0 (current)
- ğŸš€ Complete architecture rewrite
- ğŸ¤– aiogram instead of pyTelegramBotAPI
- ğŸ”„ Celery + Redis for task queue
- ğŸŒ Webhook mode instead of polling
- ğŸ˜ PostgreSQL instead of SQLite
- ğŸ“¦ MinIO S3-compatible storage
- ğŸ“Š Real-time progress tracking
- ğŸŒ¸ Flower monitoring dashboard
- âš¡ Horizontal scaling support

### v3.2
- âœ¨ Inline mode - use bot in any chat
- ğŸ¯ Auto-quality selection (best under 50MB)
- ğŸ–¼ Thumbnail preview before download
- ğŸ†• Threads (Meta) support
- ğŸ†• Twitch Clips support
- ğŸª Instagram cookies support

### v3.1
- ğŸ”§ Fixed Story chat error (pyTelegramBotAPI update)
- ğŸ¦ Twitter video pre-check
- ğŸ“ Original format preserved (no re-encoding)

### v3.0
- Smart cache, groups, metrics

### v2.0
- Audio extraction, quality selection

### v1.0
- Basic video download

## ğŸ”§ Migration from v3.x to v4.0

```bash
# 1. Stop v3.x
docker compose down

# 2. Backup data (optional)
cp -r downloads downloads_backup
cp -r bot_data bot_data_backup

# 3. Start v4.0
docker compose -f docker-compose.v4.yml up -d

# 4. Run migrations
docker compose -f docker-compose.v4.yml exec bot alembic upgrade head

# 5. Verify
docker compose -f docker-compose.v4.yml logs -f bot
```

## ğŸ“„ License

MIT License - see LICENSE file

## ğŸ™ Acknowledgments

- [yt-dlp](https://github.com/yt-dlp/yt-dlp)
- [aiogram](https://github.com/aiogram/aiogram)
- [Celery](https://github.com/celery/celery)
- [MinIO](https://min.io/)
